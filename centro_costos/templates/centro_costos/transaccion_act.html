{% extends 'centro_costos/base.html' %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <title>Editar Transacción - Secreto Heladería</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<h1>Editar Transacción</h1>

<form method="post" action="{% url 'transaccion_act' transaccion.id %}">
    {% csrf_token %}

    <div class="mb-3">
        <label for="{{ form.nombre.id_for_label }}" class="form-label">Nombre</label>
        {{ form.nombre }}
        {% if form.nombre.errors %}
            <div class="text-danger">
                {% for error in form.nombre.errors %}{{ error }}<br>{% endfor %}
            </div>
        {% endif %}
    </div>

    <div class="mb-3">
        <label for="{{ form.costo.id_for_label }}" class="form-label">Item Costo</label>
        {{ form.costo }}
        {% if form.costo.errors %}
            <div class="text-danger">
                {% for error in form.costo.errors %}{{ error }}<br>{% endfor %}
            </div>
        {% endif %}
    </div>

    {# --- NUEVO CAMPO: PROVEEDOR --- #}
    <div class="mb-3">
        <label for="{{ form.proveedor.id_for_label }}" class="form-label">Proveedor</label>
        {{ form.proveedor }}
        {% if form.proveedor.errors %}
            <div class="text-danger">
                {% for error in form.proveedor.errors %}{{ error }}<br>{% endfor %}
            </div>
        {% endif %}
    </div>
    {# --- FIN NUEVO CAMPO --- #}

    <div class="mb-3">
        <label for="{{ form.costo_total.id_for_label }}" class="form-label">Costo Total</label>
        <div class="input-group">
            <span class="input-group-text">$</span>
            {{ form.costo_total }}
        </div>
        {% if form.costo_total.errors %}
            <div class="text-danger">
                {% for error in form.costo_total.errors %}{{ error }}<br>{% endfor %}
            </div>
        {% endif %}
    </div>

    <button type="submit" class="btn btn-primary">Actualizar</button>
    <a href="{% url 'transaccion' %}" class="btn btn-secondary">Volver al listado</a>
</form>

<script>
document.addEventListener("DOMContentLoaded", function() {
    document.querySelectorAll('form input:not([type="submit"]):not([type="button"]), form select').forEach(element => {
        if (element.tagName === 'SELECT' && !element.classList.contains('form-select')) {
            element.classList.add('form-select');
        } else if (element.tagName === 'INPUT' && !element.classList.contains('form-control')) {
            element.classList.add('form-control');
        }
    });
    
    const form = document.querySelector("form");

    form.addEventListener("submit", function(e) {
        e.preventDefault();

        Swal.fire({
            title: "¿Deseas actualizar esta transacción?",
            text: "Revisa que todos los datos sean correctos antes de continuar.",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#007bff",
            cancelButtonColor: "#6c757d",
            confirmButtonText: "Sí, actualizar",
            cancelButtonText: "Cancelar"
        }).then((result) => {
            if (result.isConfirmed) {
                form.submit(); 
            }
        });
    });

    {% if messages %}
        {% for message in messages %}
            {% if message.tags == 'success' %}
                Swal.fire({
                    title: "¡Actualizado!",
                    text: "{{ message }}",
                    icon: "success",
                    confirmButtonColor: "#007bff",
                    timer: 1500,
                    showConfirmButton: false
                });
            {% endif %}
        {% endfor %}
    {% endif %}
});
</script>
{% endblock %}
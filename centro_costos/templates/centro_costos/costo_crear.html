{% extends 'centro_costos/base.html' %}

{% block content %}
<head>
  <meta charset="UTF-8">
  <title>Crear Item Costo</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
  <h1>Crear Item Costo</h1>

  <form id="form-crear" method="post" action="{% url 'costo_crear' %}">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">Guardar</button>
  </form>

  <a href="{% url 'costo' %}" class="btn btn-secondary">Volver al listado</a>
</body>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("form-crear");

    form.addEventListener("submit", function(e) {
        e.preventDefault(); // previene envío normal

        const formData = new FormData(form);

        fetch(form.action, {
            method: "POST",
            body: formData,
            headers: {
                "X-Requested-With": "XMLHttpRequest"
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                Swal.fire({
                    title: "¡Guardado!",
                    text: "El Item Costo ha sido creado exitosamente.",
                    icon: "success",
                    confirmButtonColor: "#007bff",
                    timer: 1500,
                    showConfirmButton: false
                }).then(() => {
                    window.location.href = data.redirect_url;
                });
            } else {
                let errores = "";
                for (const field in data.errors) {
                    data.errors[field].forEach(err => errores += err.message + "\n");
                }
                Swal.fire({
                    title: "Error",
                    text: errores,
                    icon: "error",
                    confirmButtonColor: "#d33"
                });
            }
        })
        .catch(err => console.log(err));
    });
});
</script>
{% endblock %}


{% extends 'centro_costos/base.html' %}

{% block content %}
<head>
    <meta charset="UTF-8">
    <title>Crear Item Costo</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>
    <h1>Crear Item Costo</h1>

    <form id="form-crear" method="post" action="{% url 'costo_crear' %}">
        {% csrf_token %}
        {# ---------------------------------------------------- #}
        {# Mostrar errores de campo directamente, sin SweetAlert2 #}
        {# ---------------------------------------------------- #}
        {% for field in form %}
            <div class="form-field">
                <label for="{{ field.id_for_label }}">{{ field.label }}:</label>
                {{ field }}
                {% for error in field.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>
        {% endfor %}
        
        {# Errores globales del formulario #}
        {% for error in form.non_field_errors %}
            <p class="error-text">{{ error }}</p>
        {% endfor %}
        
        <button type="submit" class="btn btn-primary">Guardar</button>
    </form>

    <a href="{% url 'costo' %}" class="btn btn-secondary">Volver al listado</a>
</body>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const form = document.getElementById("form-crear");

    form.addEventListener("submit", function(e) {
        e.preventDefault(); 
        
        
        Swal.fire({
            title: "¿Deseas guardar este Item Costo?",
            text: "Revisa que todos los datos sean correctos antes de continuar.",
            icon: "question",
            showCancelButton: true,
            confirmButtonColor: "#007bff",
            cancelButtonColor: "#6c757d",
            confirmButtonText: "Sí, guardar",
            cancelButtonText: "Cancelar"
        }).then((result) => {
            if (result.isConfirmed) {
                form.submit(); 
            }
        });
    });

    {% if messages %}
        {% for message in messages %}
            {% if message.tags == 'success' %}
                Swal.fire({
                    title: "¡Guardado!",
                    text: "{{ message }}",
                    icon: "success",
                    confirmButtonColor: "#007bff",
                    timer: 1500,
                    showConfirmButton: false
                });
            {% elif message.tags == 'error' %}
                Swal.fire({
                    title: "Error",
                    text: "{{ message|escapejs }}",
                    icon: "error",
                    confirmButtonColor: "#d33"
                });
            {% endif %}
        {% endfor %}
    {% endif %}
});
</script>
{% endblock %}
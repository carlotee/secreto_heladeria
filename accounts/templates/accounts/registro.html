{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro</title>
    <link rel="stylesheet" href="{% static 'accounts/registro.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="form-container">
        <h2>Registro</h2>
        <form method="post" id="registro-form">
            {% csrf_token %}
            
            
            {# 1. Campo Usuario #}
            <div class="form-field">
                <label for="{{ form.username.id_for_label }}">Usuario:</label>
                {{ form.username }}
                {% for error in form.username.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>
            
            {# 2. Campo Correo electrónico #}
            <div class="form-field">
                <label for="{{ form.email.id_for_label }}">Correo electrónico:</label>
                {{ form.email }}
                {% for error in form.email.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>

            {# 3. Campo Teléfono (Nombre Exacto: 'numero') #}
            <div class="form-field">
                <label for="{{ form.numero.id_for_label }}">Teléfono:</label>
                {{ form.numero }}
                {% for error in form.numero.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>

            {# 4. Campo Rol #}
            <div class="form-field">
                <label for="{{ form.rol.id_for_label }}">Rol:</label>
                {{ form.rol }}
                {% for error in form.rol.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>
            
            {# 5. Campo Contraseña (Nombre Exacto: 'password') #}
            <div class="form-field">
                <label for="{{ form.password.id_for_label }}">Contraseña:</label>
                {{ form.password }}
                {% for error in form.password.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>
            
            {# 6. Campo Confirmar contraseña (Nombre Exacto: 'password_confirm') #}
            <div class="form-field">
                <label for="{{ form.password_confirm.id_for_label }}">Confirmar contraseña:</label>
                {{ form.password_confirm }}
                {% for error in form.password_confirm.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>

            {# Errores globales del formulario (Non-field errors, por ejemplo, "Las contraseñas no coinciden") #}
            {% if form.non_field_errors %}
                <div class="non-field-errors">
                    {% for error in form.non_field_errors %}
                        <p class="error-text">{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <button type="submit">Registrarse</button>
        </form>
        <a href="{% url 'login' %}" class="btn-volver">Volver a inicio de sesión</a>
    </div>

    {% if messages %}
        {% for message in messages %}
            {% if 'registro_exitoso' in message.message %}
            {# Mensaje de Éxito #}
            <script>
                Swal.fire({
                    title: "¡Registro Exitoso!",
                    text: "Tu cuenta ha sido creada. Redirigiendo al login...",
                    icon: "success",
                    showConfirmButton: false,
                    timer: 2000,
                    timerProgressBar: true
                }).then(() => {
                    window.location.href = "{% url 'login' %}"; 
                });
            </script>
            {% elif message.tags == 'error' %}
            {# Mensaje de Error General #}
            <script>
                Swal.fire({
                    title: "Error",
                    text: "{{ message }}",
                    icon: "error",
                    confirmButtonText: "Aceptar"
                });
            </script>
            {% endif %}
        {% endfor %}
    {% endif %}
</body>
</html>
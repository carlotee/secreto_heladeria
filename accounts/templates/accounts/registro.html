{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro</title>
    <link rel="stylesheet" href="{% static 'accounts/registro.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body>
    <div class="form-container">
        <h2>Registro</h2>
        <form method="post" id="registro-form">
            {% csrf_token %}
            
            
            {# 1. Campo Usuario #}
            <div class="form-field">
                <label for="{{ form.username.id_for_label }}">Usuario:</label>
                {{ form.username }}
                {% for error in form.username.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>
            
            {# 2. Campo Correo electrónico (Error de posición corregido) #}
            <div class="form-field">
                <label for="{{ form.email.id_for_label }}">Correo electrónico:</label>
                {{ form.email }}
                {% for error in form.email.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>

            {# 3. Campo Teléfono #}
            <div class="form-field">
                <label for="{{ form.telefono.id_for_label }}">Teléfono:</label>
                {{ form.telefono }}
                {% for error in form.telefono.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>

            {# 4. Campo Rol #}
            <div class="form-field">
                <label for="{{ form.rol.id_for_label }}">Rol:</label>
                {{ form.rol }}
                {% for error in form.rol.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>
            
            {# 5. Campo Contraseña (Ajusta 'password' si tu campo se llama 'contrasena') #}
            <div class="form-field">
                <label for="{{ form.password.id_for_label }}">Contraseña:</label>
                {{ form.password }}
                {% for error in form.password.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>
            
            {# 6. Campo Confirmar contraseña (Ajusta 'password2' si tu campo se llama 'confirmar_contrasena') #}
            <div class="form-field">
                <label for="{{ form.password2.id_for_label }}">Confirmar contraseña:</label>
                {{ form.password2 }}
                {% for error in form.password2.errors %}
                    <p class="error-text">{{ error }}</p>
                {% endfor %}
            </div>

            {# Errores globales del formulario (Non-field errors) #}
            {% if form.non_field_errors %}
                <div class="non-field-errors">
                    {% for error in form.non_field_errors %}
                        <p class="error-text">{{ error }}</p>
                    {% endfor %}
                </div>
            {% endif %}

            <button type="submit">Registrarse</button>
        </form>
        <a href="{% url 'login' %}" class="btn-volver">Volver a inicio de sesión</a>
    </div>

    {% if form.errors and not form.non_field_errors %}
    <script>
    </script>
    {% endif %}

    {# ========================================================= #}
    {# Lógica de SweetAlert para ÉXITO #}
    {# (Mantenemos la redirección vía JS por si no usas el patrón PRG con `redirect` en la vista) #}
    {# ========================================================= #}
    {% if messages %}
        {% for message in messages %}
            {% if 'registro_exitoso' in message.message %}
            <script>
                Swal.fire({
                    title: "¡Registro Exitoso!",
                    text: "Tu cuenta ha sido creada. Redirigiendo al login...",
                    icon: "success",
                    showConfirmButton: false,
                    timer: 2000,
                    timerProgressBar: true
                }).then(() => {
                    window.location.href = "{% url 'login' %}"; 
                });
            </script>
            {% elif message.tags == 'error' %}
            <script>
                Swal.fire({
                    title: "Error",
                    text: "{{ message }}",
                    icon: "error",
                    confirmButtonText: "Aceptar"
                });
            </script>
            {% endif %}
        {% endfor %}
    {% endif %}
</body>
</html>